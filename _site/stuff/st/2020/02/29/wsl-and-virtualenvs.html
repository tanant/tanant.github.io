<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>WSL and making virtualenvs | blog (anthony’s)</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="WSL and making virtualenvs" />
<meta name="author" content="email:" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="TL;DR Ugh. That was annoying. WSL and virtualenvs not playing nicely? Use metadata." />
<meta property="og:description" content="TL;DR Ugh. That was annoying. WSL and virtualenvs not playing nicely? Use metadata." />
<link rel="canonical" href="http://localhost:4000/stuff/st/2020/02/29/wsl-and-virtualenvs.html" />
<meta property="og:url" content="http://localhost:4000/stuff/st/2020/02/29/wsl-and-virtualenvs.html" />
<meta property="og:site_name" content="blog (anthony’s)" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-29T16:00:00-05:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"WSL and making virtualenvs","dateModified":"2020-02-29T16:00:00-05:00","datePublished":"2020-02-29T16:00:00-05:00","url":"http://localhost:4000/stuff/st/2020/02/29/wsl-and-virtualenvs.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/stuff/st/2020/02/29/wsl-and-virtualenvs.html"},"author":{"@type":"Person","name":"email:"},"description":"TL;DR Ugh. That was annoying. WSL and virtualenvs not playing nicely? Use metadata.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="blog (anthony's)" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">blog (anthony&#39;s)</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/diagnostics/">Diagnostics</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">WSL and making virtualenvs</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-02-29T16:00:00-05:00" itemprop="datePublished">Feb 29, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="tldr">TL;DR</h1>
<p>Ugh. That was annoying. WSL and virtualenvs not playing nicely? Use metadata.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cuberdon:/mnt/c/Windows/system32# cat /etc/wsl.conf
[automount]
options = "metadata,uid=1000,gid=1000,umask=22,fmask=111"
</code></pre></div></div>

<h3 id="aaannd-details">…aaannd details</h3>
<p>I’ve been progressively trying to set up my development environment properly using a mix of tools (I’ve gone down the somewhat silly route of just using whatever I have to hand so it’s a.. well. It’s a mess.) of which WSL is actually one of the core bits<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p>

<p>For the longest time today I wasn’t sure if I was going inane, or there was some secret sauce I was missing in order to make proper virtualenvs in WSL. This is what I was getting (I’m on Debian Buster)</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span><span class="w"> </span>python3 <span class="nt">-m</span> venv ./playpen
<span class="go">
The virtual environment was not created successfully because ensurepip is not
available.  On Debian/Ubuntu systems, you need to install the python3-venv
package using the following command.

    apt-get install python3-venv

You may need to use sudo with that command.  After installing the python3-venv
package, recreate your virtual environment.

Failing command: ['/mnt/e/venvs/foo/bin/python3', '-Im', 'ensurepip', '--upgrade', '--default-pip']</span></code></pre></figure>

<p>Reading through a heap of blogs and stuff, they always seem to come back to things being not installed or some other malarkey.. which in the WSL land is not the case. By way of demonstration, this works fine</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>python3 <span class="nt">-m</span> venv ./playpen</code></pre></figure>

<p>Which means there’s something else in the works. You could just happily sudo forever (kinda) but it’s been drilled into me that, just like becoming root, sudo is <em>not</em> a normal practice and so since i’m not on the clock I spent some time killing zombies and letting my brain work out what was up… and turns out it’s as i had an inkling, because everything was owned by root.</p>

<p>Odds on, if you’ve got a default setup in your WSL stack (or in my case, you’re upgrading from an old WSL setup then you’re going to be in an interesting state where your external drives are mounted thusly:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">C:\ on /mnt/c type drvfs (rw,noatime,uid=0,gid=0,case=off)
E:\ on /mnt/e type drvfs (rw,noatime,uid=0,gid=0,case=off)</span></code></pre></figure>

<p>This won’t cause you any issues as you happily shove files around, but have you noticed that everything on C and E is owned by root? The 777/666 permissions means you might not notice it, but it’s all owned by root.</p>

<p>What you <em>want to see</em> is this:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">C: on /mnt/c type drvfs (rw,relatime,metadata,case=off)
E: on /mnt/e type drvfs (rw,relatime,metadata,case=off)</span></code></pre></figure>

<p><em>sigh</em></p>

<p>Turns out there was a feature applied back in Jan 2018 to start mapping over metadata in WSL (Insider Build 17063+, but that’s 2 years ago. You should have it by now), and did you know you can automatically configure this?</p>

<ul>
  <li><a href="https://devblogs.microsoft.com/commandline/chmod-chown-wsl-improvements/">Chmod/Chown WSL Improvements</a></li>
  <li><a href="https://devblogs.microsoft.com/commandline/automatically-configuring-wsl/">Automatically Configuring WSL</a></li>
</ul>

<p><br /></p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>I like playing games. Games tend to work on windows more than *nix. Is true. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div><a class="u-url" href="/stuff/st/2020/02/29/wsl-and-virtualenvs.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">blog (anthony&#39;s)</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">email:</li><li><a class="u-email" href="mailto:anthony.tan@greenworm.net">anthony.tan@greenworm.net</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/tanant"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">tanant</span></a></li><li><a href="https://www.linkedin.com/in/tanant"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">tanant</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A collection of notes that probably deserves a better home than being in the form of textfiles  and archives sitting on my desktop at home.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
